---
title: "HW 07 - SOTU"
author: "Shirisha Biyyala"
date: " `r Sys.Date()` "
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load packages and data

```{r load-packages, message = FALSE, warning= FALSE}
library(tidytext)
library(tidyverse)
library(ggwordcloud)
library(sotu)
library(textstem)
```


```{r view-data}
view(sotu_meta)
glimpse(sotu_meta)

view(sotu_text)
glimpse(sotu_text)
```

## Exercises

### Merge Datasets

```{r merge-datasets}
# Convert sotu_text to a dataframe
sotu_text_df <- tibble(speech = sotu_text)

# Merge the sotu_meta and sotu_text_df
sotu <- sotu_meta %>%
  add_column(speech = sotu_text_df$speech) %>%
  as_tibble() %>%
  rename(doc_id = X)

# Check the tibble
glimpse(sotu)
```

```{r preliminary-tasks}
head(sotu)
view(sotu)
```

## Exploratory Data Analysis

### Obama’s Speeches: Text Analysis


```{r filter-tokenize}
obama_n <- sotu %>%
  filter(president == "Barack Obama") %>%
  unnest_tokens(word, speech, to_lower = FALSE, strip_punct = FALSE) %>%
  count(word, sort = TRUE)

head(obama_n)
```


```{r stop-words-removed}
obama_n_cleaned <- obama_n %>%
  anti_join(stop_words, by = "word") %>%
  filter(n >= 10, nchar(word) >= 2) %>%
  slice_max(n, n = 200)

head(obama_n)
```

#### Word Cloud for Obama’s Speeches

```{r plot-word-cloud}
ggplot(obama_n_cleaned) +
  geom_text_wordcloud(aes(label = word, size = n, color = n), rm_outside = TRUE) +
  scale_size_area(max_size = 8) +
  theme_void() +
  labs(title = "Word Cloud of Obama's SOTU Speeches")


```

## From Obama to everyone

```{r tokenize-corpus}
sotu_corpus <- sotu %>%
  unnest_tokens(word, speech) %>%
  count(word, sort = TRUE)

head(sotu_corpus)
```

```{r most-common-words}
top_words <- sotu_corpus %>%
  anti_join(stop_words, by = "word") %>%
  slice_max(n, n = 10)
print(top_words)

```

```{r lemmatization}
sotu_corpus <- sotu_corpus %>%
  mutate(lemmata = lemmatize_words(word))

head(sotu_corpus)
```

```{r top-100-frequent-words}
sotu_top_words <- sotu_corpus %>%
  count(lemmata, sort = TRUE) %>%
  slice_max(n, n = 100)

sotu_top_words
```

## Analyzing and visualizing texts

```{r word-cloud}
ggplot(sotu_top_words) +
  geom_text_wordcloud(aes(label = lemmata, size = n, color = n), rm_outside = TRUE) +
  scale_size_area(max_size = 8) +
  theme_void() +
  labs(title = "Word Cloud of All SOTU Speeches")
```

```{r bar-plot-top-words}
sotu_top_25 <- sotu_top_words %>%
  slice_max(n, n = 25)

ggplot(sotu_top_25, aes(x = reorder(lemmata, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 25 Words in SOTU Speeches",
    x = "Words",
    y = "Frequency"
  ) +
  theme_minimal()
```

```{r test}
# Create the bar plot with adjustments to avoid overlapping labels
ggplot(sotu_top_25, aes(x = reorder(lemmata, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 25 Words in SOTU Speeches",
    x = "Words",
    y = "Frequency"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(angle = 45, hjust = 1, size = 10),  # Rotate and reduce text size
    plot.margin = margin(1, 1, 1, 3, "cm")  # Increase left margin
  ) +
  scale_y_discrete(expand = expansion(mult = c(0.1, 0.1)))  # Adjust y-axis spacing

```


```{r td-idf-analysis}
sotu_tfidf <- sotu %>%
  unnest_tokens(word, speech) %>%
  count(president, word, sort = TRUE) %>%
  bind_tf_idf(word, president, n)

```

```{r faceted-bar-plot}
top_tfidf <- sotu_tfidf %>%
  group_by(president) %>%
  slice_max(tf_idf, n = 10) %>%
  ungroup()

ggplot(top_tfidf, aes(x = reorder_within(word, tf_idf, president), y = tf_idf, fill = president)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ president, scales = "free_y") +
  coord_flip() +
  scale_x_reordered() +
  labs(
    title = "Top 10 Words by TF-IDF for Each President",
    x = "Words",
    y = "TF-IDF"
  ) +
  theme_minimal()
```

