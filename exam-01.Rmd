---
title: "MILESTONE EXAM 1 - STUDENT TEMPLATE"
author: "Shirisha Biyyala"
date: "Due: October 2, 2024"
output: 
  github_document: 
    fig_height: 4
    fig_width: 7
---

```{r setup, include = FALSE}
# set the echo option to FALSE to see how the document looks with the code suppressed
knitr::opts_chunk$set(echo = TRUE)
```

## Academic Honesty Statement

I, Shirisha Biyyala, hereby state that I have not communicated with or gained information in any way from my classmates or anyone other than the Professor or TA during this exam, and that all work is my own.

## Load packages

```{r load-packages, message=FALSE}
# load required packages here
library(tidyverse)
library(nycflights13)
library(ggplot2)
library(dplyr)
library(knitr)
library(htmltools)
```

## Questions 

#### Understand the dataset

This section allows us to view the entire `flights` dataset from the `nycflights13` package. It also provides access to documentation for understanding the datasets' variables and attributes.


```{r understand-data}
#view(flights)
#?flights
```

In this section, we extract the first few rows of the `flights` dataset to get a **glimpse of the data**. 

```{r flights-head}
# Get the head of the dataset
flights_head <- head(flights)

# Create an HTML table
html_table <- knitr::kable(flights_head, format = "html", escape = FALSE)

# Print the scrollable table
HTML(paste0(
  "<div style='overflow-x: auto; max-width: 100%; height: 300px;'>",
  html_table,
  "</div>"
))
```

#### Exploratory Data Analysis

This section conducts an initial **exploratory analysis** by checking the structure of the `flights` dataset using glimpse, which provides a compact view of the data types and sample values. It counts the number of missing values in each column to identify potential issues with data completeness. Finally, **summary statistics** are generated for key features like departure delay, arrival delay, distance, and airtime, allowing for a better understanding of flight performance and trends.


```{r exploratory-data-analysis}
# Check structure and missing values
glimpse(flights)

# Count missing values in each column
sapply(flights, function(x) sum(is.na(x)))

# Summary statistics for key features
summary(flights %>% select(dep_delay, arr_delay, distance, air_time))
```

### Question 1

To identify the **ten most common flight destinations** from NYC airports in 2013, I grouped the flights dataset by the `dest` column and counted the number of flights to each destination. After *sorting* the results in descending order, I selected the top ten destinations.


```{r most-common-destinations}
flights %>% 
  group_by(dest) %>% 
  summarise(flight_count = n()) %>% 
  arrange(desc(flight_count)) %>% 
  top_n(10)   # Select the top 10 destinations
```

From the table, we can see that **ORD** had the highest number of flights from NYC, followed closely by **ATL** and **LAX**. This indicates that these cities were the most popular destinations for travelers flying out of New York City in 2013.

### Question 2

To determine which airlines had the **most flights departing** from NYC airports in 2013, I grouped the `flights` dataset by the `carrier` column and calculated the total number of flights for each airline. I then joined this data with the airlines dataset to retrieve the airline names, sorted the results in descending order, and presented the flight counts alongside their respective airline names.


```{r most-flights-departing}
flights %>% 
  group_by(carrier) %>% 
  summarise(flight_count = n()) %>% 
  arrange(desc(flight_count)) %>%            
  left_join(airlines, by = "carrier") %>% 
  rename(airline_name = name)
```

From the table, we can see that **United Air Lines Inc.** (58665) had the highest number of flights from NYC, followed by **JetBlue Airways**(54635) and **ExpressJet Airlines Inc.**(54173) This highlights the dominance of these airlines in the NYC air travel market during 2013.

### Question 3

To analyze the **arrival delays of flights** with non-missing delay information, I filtered the `flights` dataset to exclude any rows where the `arr_delay` value is missing. I then grouped the data by the `carrier` column, calculating the *mean arrival delay for each airline*. After sorting the results, I identified the carrier with the **highest and lowest mean arrival delays**, along with their corresponding carrier codes.

```{r arrival-delays}
flights %>% 
  filter(!is.na(arr_delay)) %>% 
  group_by(carrier) %>% 
  summarise(mean_arr_delay = round(mean(arr_delay), 4)) %>%
  left_join(airlines, by= "carrier") %>% 
  arrange(desc(mean_arr_delay))
```

#### Highest mean arrival delay
The carrier with the highest mean arrival delay is **Frontier Airlines Inc. (F9)**, with an average delay of **21.92 minutes**. This indicates that, on average, flights operated by Frontier Airlines arrived nearly **22 minutes later** than their scheduled time, suggesting potential operational challenges affecting punctuality.


#### Lowest mean arrival delay
Conversely, **Alaska Airlines Inc. (AS)** had the lowest mean arrival delay, averaging **-9.93 minutes**. This negative value indicates that, on average, Alaska Airlines flights arrived about **10 minutes earlier** than scheduled. This suggests that Alaska Airlines was the most punctual among the carriers analyzed, performing well in terms of timely arrivals.

#### References
1. https://stackoverflow.com/questions/66422564/round-numbers-in-r-correctly

### Question 4

In this code, we're working on **identifying the mean temperature at the origin airport** on the day with the highest total departure delay in 2013.

#### Step 4.1: Find the Day with the Highest Departure Delay

```{r max-dep-delay}
# To find the day with the highest departure delay
max_dep_delay <- flights %>% 
  group_by(year, month, day) %>% 
  summarise(total_dep_delay = sum(dep_delay, na.rm = TRUE), .groups = 'drop') %>% 
  arrange(desc(total_dep_delay)) %>% 
  slice(1)

max_dep_delay
```

The goal here is to group `flights` by date (`year`, `month`, `day`) and calculate the total departure delay for each day. By using `arrange(desc(total_dep_delay))`, the days are sorted in descending order of total delay, and `slice(1)` selects the day with the maximum total delay. This gives us the specific date to focus on.

From this table, we identified that **March 8, 2013**, had the highest total departure delay, amounting to **66,746 minutes**. This indicates that on this particular day, there was a significant disruption at NYC airports, causing extensive delays across multiple flights.


#### Step 4.2: Join Flights with Weather Data

Initially, a warning was triggered due to multiple rows from both datasets matching each other on the same day and airport, creating a many-to-many relationship. To handle this, we first combined the weather data by grouping it by year, month, day, and origin. This ensures that for each origin airport on each day, we have a single temperature value.

We calculate the daily mean temperature using the `mean(temp, na.rm = TRUE)` function. By grouping and summarizing, we ensure that when joining the flight data with the weather data, the join operation provides a unique temperature value for each origin on each specific day.

```{r weather-origin}
# Filter weather data for that day and origin airport
mean_temp <- flights %>%
  filter(year == max_dep_delay$year, 
         month == max_dep_delay$month, 
         day == max_dep_delay$day) %>%
  left_join(weather, by = c("year", "month", "day", "origin"), 
            relationship = "many-to-many") %>%  # To handle many-to-many relationship
  group_by(origin) %>%  # Group by origin to retain it in summarise
  summarise(mean_temperature = mean(temp, na.rm = TRUE), .groups = 'drop') %>%
  mutate(date = as.Date(paste(max_dep_delay$year, max_dep_delay$month, max_dep_delay$day, sep = "-"))) %>%
  select(origin, date, mean_temperature)  

mean_temp
```

This table provides the mean temperature at each of the three NYC airports (JFK, EWR, and LGA) on March 8, 2013:

- **JFK**: The mean temperature was **34.97째F**.
- **EWR**: The mean temperature was **35.31째F**.
- **LGA**: The mean temperature was **36.34째F**.

This gives us insight into the weather conditions on the day with the most significant departure delays. Although the temperatures were close to each other across the three airports, all hovered around the mid-30s Fahrenheit, which is relatively cool and might have contributed to flight delays, especially if there were additional weather factors like wind or precipitation.

#### Conclusion:
The day with the highest total departure delay was **March 8, 2013**, with a total delay of **66,746 minutes**. The mean temperatures at the NYC airports on that day were around **35째F**, but further investigation into specific weather events (e.g., storms) may explain why such extensive delays occurred.

#### References

1. https://stackoverflow.com/questions/39420136/combine-separate-year-and-month-columns-into-single-date-column
2. https://dplyr.tidyverse.org/reference/mutate-joins.html

### Question 5

The code filters flights to exclude those with missing departure delays, then categorizes the remaining flights into *four time intervals* based on their departure times using the `case_when()` function. It groups the data by these intervals, calculating the total number of flights and the count of delayed flights for each interval. The proportion of delayed flights is calculated using the formula:

\[
\text{Proportion of Delayed Flights} = \frac{\text{Delayed Flights}}{\text{Total Flights}}
\]

Finally, it sorts the intervals in chronological order to provide a clear view of how delays fluctuate throughout the day.


```{r flight-delay-time-interval}
# Define the time intervals
flights_time_intervals <- flights %>%
  filter(!is.na(dep_delay)) %>%                   # Filter flights with non-missing dep_delay
  mutate(time_interval = case_when(
    dep_time >= 0 & dep_time <= 600 ~ "12:01am-6am",     # Early morning
    dep_time > 600 & dep_time <= 1200 ~ "6:01am-12pm",   # Morning
    dep_time > 1200 & dep_time <= 1800 ~ "12:01pm-6pm",  # Afternoon
    dep_time > 1800 & dep_time <= 2400 ~ "6:01pm-12am"   # Evening
  )) %>%
  group_by(time_interval) %>%
  summarise(
    total_flights = n(),                               # Total number of flights in each interval
    delayed_flights = sum(dep_delay > 0, na.rm = TRUE), # Count flights delayed
    prop_delayed = round(delayed_flights / total_flights, 4)      # Proportion of delayed flights
  ) %>%
  arrange(time_interval)  # Sort by time interval

flights_time_intervals
```

#### Key Findings:

**Early Morning (12:01am-6am):**  
This period shows the lowest proportion of delayed flights at 16.6%. Fewer flights and reduced airport congestion during the early hours may contribute to this.

**Morning (6:01am-12pm):**  
The proportion of delayed flights rises to 24.7%. This could be due to increased air traffic as more flights depart during the morning, leading to slight operational delays.

**Afternoon (12:01pm-6pm):**  
During this period, delays become more frequent, with 44% of flights delayed. The afternoon tends to have heavy air traffic, and delays from earlier in the day can accumulate.

**Evening (6:01pm-12am):**  
The likelihood of delay is highest in the evening, with 57% of flights experiencing delays. This suggests that delays compound as the day progresses, resulting in more late departures by evening.

#### Conclusion:
The analysis shows that the chances of a flight being delayed at departure steadily increase throughout the day. Early morning flights are the least likely to be delayed, while flights departing in the evening face a much higher probability of delay. This pattern is likely due to the buildup of delays from earlier flights, increasing congestion, and operational challenges during peak travel times.

#### References
1. https://stackoverflow.com/a/64980831

### Question 6

[Enter code and narrative here.]

### Question 7

[Enter code and narrative here.]

### Question 8

[Enter code and narrative here.]

### Extra Credit

[Enter code and narrative here.]


